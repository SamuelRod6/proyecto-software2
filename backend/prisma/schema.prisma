generator client {
  provider = "prisma-client-go"
  output   = "./db"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id_usuario    Int      @id @default(autoincrement())
  nombre        String   @unique
  email         String   @unique
  password_hash String
  id_rol        Int
  rol           Roles    @relation(fields: [id_rol], references: [id_rol])
  createdAt     DateTime @default(now())
  inscripciones Inscripcion[]
  notificaciones Notificacion[] @relation("UsuarioNotificaciones")
}

model Roles {
  id_rol      Int       @id @default(autoincrement())
  nombre_rol  String    @unique
  descripcion String
  createdAt   DateTime  @default(now())
  Usuario     Usuario[]
}

model Evento {
  id_evento                  Int      @id @default(autoincrement())
  nombre                     String   @unique
  fecha_inicio               DateTime
  fecha_fin                  DateTime
  fecha_cierre_inscripcion   DateTime
  inscripciones_abiertas_manual Boolean @default(true)
  ubicacion                  String
  createdAt                  DateTime @default(now())
  cancelado                  Boolean  @default(false)
  inscripciones              Inscripcion[]
  notificaciones             Notificacion[] @relation("EventoNotificaciones")
}

model Inscripcion {
  id_inscripcion Int      @id @default(autoincrement())
  fecha          DateTime @default(now())
  estado_pago    Boolean  @default(false)
  comprobante    String   @default("")
  id_evento      Int
  id_usuario     Int
  evento         Evento   @relation(fields: [id_evento], references: [id_evento])
  usuario        Usuario  @relation(fields: [id_usuario], references: [id_usuario])

  @@unique([id_evento, id_usuario])
}

model Notificacion {
  id_notificacion Int       @id @default(autoincrement())
  id_usuario      Int
  id_evento       Int?
  tipo            String
  mensaje         String
  leida           Boolean   @default(false)
  createdAt       DateTime  @default(now())

  usuario         Usuario   @relation("UsuarioNotificaciones", fields: [id_usuario], references: [id_usuario])
  evento          Evento?   @relation("EventoNotificaciones", fields: [id_evento], references: [id_evento])
}

model JobExecution {
  id        Int      @id @default(autoincrement())
  job_name  String   @unique
  last_run  DateTime
}
model Pais {
  id_pais   Int      @id @default(autoincrement())
  nombre    String   @unique
  createdAt DateTime @default(now())
  ciudades  Ciudad[]
}

model Ciudad {
  id_ciudad Int      @id @default(autoincrement())
  nombre    String
  id_pais   Int
  pais      Pais     @relation(fields: [id_pais], references: [id_pais])
  createdAt DateTime @default(now())

  @@unique([nombre, id_pais])
}
